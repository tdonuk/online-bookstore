{"ast":null,"code":"import axios from 'axios';\nimport { BehaviorSubject } from 'rxjs';\nconst URL = \"http://localhost:8765/api/user\";\nconst currentUser = new BehaviorSubject(JSON.parse(localStorage.getItem('currentUser')));\n\nclass UserService {\n  get currentUserValue() {\n    return currentUser.value;\n  }\n\n  get currentUser() {\n    return currentUser.asObservable;\n  }\n\n  login(user) {\n    const headers = {\n      \"Content-Type\": \"application/json\",\n      \"Access-Control-Allow-Origin\": \"*\"\n    };\n    return axios({\n      url: URL + \"/login\",\n      method: \"POST\",\n      withCredentials: false,\n      data: JSON.stringify(user)\n    }).then(response => {\n      this.updateLastLogin(response);\n      return response;\n    }, error => error);\n  }\n\n  updateLastLogin(loginResponse) {\n    const body = {\n      id: loginResponse.data.user.userId,\n      date: loginResponse.data.user.lastLoginDate\n    };\n    const headers = {\n      \"Content-Type\": \"application/json\",\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Authorization\": \"Bearer \" + loginResponse.headers[\"access_token\"]\n    };\n    axios({\n      url: URL + \"/checkin\",\n      headers: headers,\n      method: \"POST\",\n      withCredentials: false,\n      data: JSON.stringify(new Date())\n    }).then(response => {\n      console.log(\"login success\");\n    }, error => {\n      console.log(error);\n    });\n  }\n\n  logout() {\n    return axios.post(URL + \"/logout\", {}).then(response => {\n      localStorage.removeItem('currentUser');\n      currentUser.next(null);\n    });\n  }\n\n  register(user) {\n    return axios.post(URL + 'register', JSON.stringify(user)), {\n      headers: {\n        'Content-Type': 'application/json; charset=UTF-8'\n      }\n    };\n  }\n\n}\n\nexport default new UserService();","map":{"version":3,"sources":["C:/Users/Taha Donuk/Desktop/Workshop/Software/Online Bookstore/client/src/service/UserService.js"],"names":["axios","BehaviorSubject","URL","currentUser","JSON","parse","localStorage","getItem","UserService","currentUserValue","value","asObservable","login","user","headers","url","method","withCredentials","data","stringify","then","response","updateLastLogin","error","loginResponse","body","id","userId","date","lastLoginDate","Date","console","log","logout","post","removeItem","next","register"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,eAAR,QAA8B,MAA9B;AAEA,MAAMC,GAAG,GAAG,gCAAZ;AACA,MAAMC,WAAW,GAAG,IAAIF,eAAJ,CAAoBG,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAApB,CAApB;;AAEA,MAAMC,WAAN,CAAkB;AACI,MAAhBC,gBAAgB,GAAG;AACrB,WAAON,WAAW,CAACO,KAAnB;AACD;;AAEc,MAAXP,WAAW,GAAG;AAChB,WAAOA,WAAW,CAACQ,YAAnB;AACD;;AAEDC,EAAAA,KAAK,CAACC,IAAD,EAAO;AACV,UAAMC,OAAO,GAAG;AACd,sBAAgB,kBADF;AAEd,qCAA+B;AAFjB,KAAhB;AAKA,WAAOd,KAAK,CAAC;AACXe,MAAAA,GAAG,EAAEb,GAAG,GAAG,QADA;AAEXc,MAAAA,MAAM,EAAE,MAFG;AAGXC,MAAAA,eAAe,EAAE,KAHN;AAIXC,MAAAA,IAAI,EAAEd,IAAI,CAACe,SAAL,CAAeN,IAAf;AAJK,KAAD,CAAL,CAKJO,IALI,CAKCC,QAAQ,IAAI;AAClB,WAAKC,eAAL,CAAqBD,QAArB;AACA,aAAOA,QAAP;AACD,KARM,EAQJE,KAAK,IAAIA,KARL,CAAP;AASD;;AAEDD,EAAAA,eAAe,CAACE,aAAD,EAAgB;AAC7B,UAAMC,IAAI,GAAG;AACXC,MAAAA,EAAE,EAAEF,aAAa,CAACN,IAAd,CAAmBL,IAAnB,CAAwBc,MADjB;AAEXC,MAAAA,IAAI,EAAEJ,aAAa,CAACN,IAAd,CAAmBL,IAAnB,CAAwBgB;AAFnB,KAAb;AAKA,UAAMf,OAAO,GAAG;AACd,sBAAgB,kBADF;AAEd,qCAA+B,GAFjB;AAGd,uBAAiB,YAAYU,aAAa,CAACV,OAAd,CAAsB,cAAtB;AAHf,KAAhB;AAMAd,IAAAA,KAAK,CAAC;AACJe,MAAAA,GAAG,EAAEb,GAAG,GAAG,UADP;AAEJY,MAAAA,OAAO,EAAEA,OAFL;AAGJE,MAAAA,MAAM,EAAE,MAHJ;AAIJC,MAAAA,eAAe,EAAE,KAJb;AAKJC,MAAAA,IAAI,EAAEd,IAAI,CAACe,SAAL,CAAe,IAAIW,IAAJ,EAAf;AALF,KAAD,CAAL,CAMGV,IANH,CAMQC,QAAQ,IAAI;AAClBU,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACD,KARD,EAQGT,KAAK,IAAI;AACVQ,MAAAA,OAAO,CAACC,GAAR,CAAYT,KAAZ;AACD,KAVD;AAWD;;AAEDU,EAAAA,MAAM,GAAG;AACP,WAAOjC,KAAK,CAACkC,IAAN,CAAWhC,GAAG,GAAG,SAAjB,EAA4B,EAA5B,EAAgCkB,IAAhC,CAAqCC,QAAQ,IAAI;AACtDf,MAAAA,YAAY,CAAC6B,UAAb,CAAwB,aAAxB;AACAhC,MAAAA,WAAW,CAACiC,IAAZ,CAAiB,IAAjB;AACD,KAHM,CAAP;AAID;;AAEDC,EAAAA,QAAQ,CAACxB,IAAD,EAAO;AACb,WAAOb,KAAK,CAACkC,IAAN,CAAWhC,GAAG,GAAG,UAAjB,EAA6BE,IAAI,CAACe,SAAL,CAAeN,IAAf,CAA7B,GAAoD;AAACC,MAAAA,OAAO,EAAE;AAAC,wBAAe;AAAhB;AAAV,KAA3D;AACD;;AA5De;;AA+DlB,eAAe,IAAIN,WAAJ,EAAf","sourcesContent":["import axios from 'axios'\r\nimport {BehaviorSubject} from 'rxjs';\r\n\r\nconst URL = \"http://localhost:8765/api/user\";\r\nconst currentUser = new BehaviorSubject(JSON.parse(localStorage.getItem('currentUser')));\r\n\r\nclass UserService {\r\n  get currentUserValue() {\r\n    return currentUser.value;\r\n  }\r\n\r\n  get currentUser() {\r\n    return currentUser.asObservable;\r\n  }\r\n\r\n  login(user) {\r\n    const headers = {\r\n      \"Content-Type\": \"application/json\",\r\n      \"Access-Control-Allow-Origin\": \"*\"\r\n    }\r\n\r\n    return axios({\r\n      url: URL + \"/login\",\r\n      method: \"POST\",\r\n      withCredentials: false,\r\n      data: JSON.stringify(user)\r\n    }).then(response => {\r\n      this.updateLastLogin(response);\r\n      return response;\r\n    }, error => error);\r\n  }\r\n\r\n  updateLastLogin(loginResponse) {\r\n    const body = {\r\n      id: loginResponse.data.user.userId,\r\n      date: loginResponse.data.user.lastLoginDate\r\n    }\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/json\",\r\n      \"Access-Control-Allow-Origin\": \"*\",\r\n      \"Authorization\": \"Bearer \" + loginResponse.headers[\"access_token\"]\r\n    }\r\n\r\n    axios({\r\n      url: URL + \"/checkin\",\r\n      headers: headers,\r\n      method: \"POST\",\r\n      withCredentials: false,\r\n      data: JSON.stringify(new Date())\r\n    }).then(response => {\r\n      console.log(\"login success\")\r\n    }, error => {\r\n      console.log(error);\r\n    });\r\n  }\r\n\r\n  logout() {\r\n    return axios.post(URL + \"/logout\", {}).then(response => {\r\n      localStorage.removeItem('currentUser');\r\n      currentUser.next(null);\r\n    });\r\n  }\r\n\r\n  register(user) {\r\n    return axios.post(URL + 'register', JSON.stringify(user)), {headers: {'Content-Type':'application/json; charset=UTF-8'}};\r\n  }\r\n}\r\n\r\nexport default new UserService();\r\n"]},"metadata":{},"sourceType":"module"}